filetype plugin indent on   " Identify language specific indent options
filetype plugin on
syntax on                   " use syntax..

set autoread                " auto reload files on change
set noswapfile

" read file settings
set ffs=unix,dos,mac
set backspace=indent,eol,start 

" Visual settings
set t_Co=256
set background=dark
colorscheme jellybeans " lucius (dark) molokai (dark) jellybean (dark) ir_black (dark) iceberg molokai hemisu apprentice hybrid

" UI
set showcmd     " Show cmd below
set number      " Show line numbers
set showmatch   " Show matching (improved by matchit plugin)
set linebreak   "
set cursorline  " highlight current line

set scrolloff=5 " always show 5 lines above and below cursor
set hidden " hides abandoned buffers
set lazyredraw  " only redraw if necessary (improves macros performance)

" Draw tabs as >.
set list
set listchars=tab:»·,trail:·

" search settings
set hlsearch
set incsearch
set smartcase
set ignorecase

" Tabs / spaces
set expandtab
set autoindent
set smartindent
set smarttab
autocmd FileType make set noexpandtab " Tabs in make files

set shiftwidth=2
set tabstop=2
set softtabstop=2 

" autocomplete cmdline
set wildmenu
set wildmode=longest,list:longest

" ctrlp settings
let g:ctrlp_user_command = 'ag %s -l --nocolor -g ""'

" ==================== Airline ====================
set laststatus                            =2
let g:airline#extensions#tabline#enabled  = 1    " Enable the list of buffers
let g:airline#extensions#tabline#fnamemod = ':t' " show just name
let g:airline_powerline_fonts = 1

" Settings of syntastic
let g:syntastic_cpp_compiler_options     = '-std=c++11'
let g:syntastic_always_populate_loc_list = 1

" ==================== NerdTree ====================
autocmd VimEnter * NERDTree " Open nerdtree on vim startup
autocmd VimEnter * wincmd p " Focus on main window on startup
let g:nerdtree_tabs_focus_on_files = 1
let g:NERDTreeShowHidden           = 1

" Regular files need spelling and no highlight end
augroup noProg
autocmd BufRead,BufNewFile *.txt setlocal spell spelllang=en_us 
autocmd BufRead,BufNewFile *.tex setlocal spell spelllang=en_us 
autocmd BufRead,BufNewFile *.md setlocal spell spelllang=en_us 
augroup END

" ==================== UltiSnips ====================
" snippets
" trigger configuration
" let g:UltiSnipsExpandTrigger="<tab>"

set nowrap

let g:javascript_plugin_jsdoc = 1
let g:javascript_plugin_ngdoc = 1

" ==================== Prettier ====================
let g:prettier#config#bracket_spacing = 'true'
let g:prettier#config#jsx_bracket_same_line = 'false'
let g:prettier#autoformat = 0
autocmd BufWritePre *.js,*.jsx,*.mjs,*.ts,*.tsx,*.css,*.less,*.scss,*.json,*.graphql,*.md,*.vue,*.html PrettierAsync

" ==================== Deoplete ====================
" deoplete tab-complete
if has('nvim')
  let g:deoplete#enable_at_startup = 1
  let g:deoplete#ignore_sources = {}
  let g:deoplete#ignore_sources._ = ['buffer', 'member', 'tag', 'file', 'neosnippet']
  let g:deoplete#sources#go#sort_class = ['func', 'type', 'var', 'const']
  let g:deoplete#sources#go#align_class = 1
  let g:deoplete#file#enable_buffer_path = 1
  let g:deoplete#enable_smart_case = 1

  " Use partial fuzzy matches like YouCompleteMe
  call deoplete#custom#source('_', 'matchers', ['matcher_fuzzy'])
  call deoplete#custom#source('_', 'converters', ['converter_remove_paren'])
  call deoplete#custom#source('_', 'disabled_syntaxes', ['Comment', 'String'])

  set completeopt=longest,menuone,preview
  "let g:deoplete#sources = {}
  "let g:deoplete#sources['javascript.jsx'] = ['file', 'ultisnips', 'ternjs']

  if !exists('g:deoplete#omni#input_patterns')
    let g:deoplete#omni#input_patterns = {}
  endif
  "if !exists('g:deoplete#omni#functions')
  "  let g:deoplete#omni#functions = {}
  "endif
  "let g:deoplete#omni#functions.typescript = [
  "\ 'tern#Complete',
  "\ 'jspc#omni'
  "\]
  "let g:deoplete#omni#functions.javascript = [
  "\ 'tern#Complete',
  "\ 'jspc#omni'
  "\]
  " let g:deoplete#disable_auto_complete = 1

endif

" ==================== Omni ====================
augroup omnifuncs
autocmd!
autocmd FileType css setlocal omnifunc=csscomplete#CompleteCSS
autocmd FileType html,markdown setlocal omnifunc=htmlcomplete#CompleteTags
autocmd FileType javascript setlocal omnifunc=javascriptcomplete#CompleteJS
autocmd FileType python setlocal omnifunc=pythoncomplete#Complete
autocmd FileType xml setlocal omnifunc=xmlcomplete#CompleteTags
augroup end

" ==================== Tern ====================
autocmd FileType javascript nnoremap <silent> <buffer> gb :TernDef<CR>
if exists('g:plugs["tern_for_vim"]')
let g:tern_show_argument_hints = 'on_hold'
let g:tern_show_signature_in_pum = 1
let g:tern#command = ['tern']
let g:tern#arguments = ['--persistent']
autocmd FileType javascript setlocal omnifunc=tern#Complete
endif

" ==================== delimitMate ====================
let g:delimitMate_expand_cr = 1
let g:delimitMate_expand_space = 1
let g:delimitMate_smart_quotes = 1
let g:delimitMate_expand_inside_quotes = 0
let g:delimitMate_smart_matchpairs = '^\%(\w\|\$\)'

" spell check for git commits
autocmd FileType gitcommit setlocal spell

" autocomplete
autocmd FileType css setlocal omnifunc=csscomplete#CompleteCSS
autocmd InsertLeave,CompleteDone * if pumvisible() == 0 | pclose | endif"
